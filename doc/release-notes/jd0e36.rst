
========================
New and Changed Features
========================

The features listed in this section are new or changed as of Contrail Release 5.0. A brief description of each new feature is included.

   -  `EVPN vRouter MultiHoming to Multiple TORs`_ 


   -  `Routing Policies Enhanced for Interface Routes`_ 


   -  `Remote Compute`_ 


   -  `Contrail Networking Packaging without OpenStack`_ 


   -  `Distributed Source Network Address Translation (SNAT)`_ 


   -  `Kubernetes Updates to ip-fabric and Role-Based Access Control`_ 


   -  `Contrail Microservices`_ 


   -  `Ansible Scripts to Provision Contrail`_ 


   -  `Load Balancing with HAProxy Available in Contrail Web UI`_ 


   -  `Contrail plugin for VMware vRealize Orchestrator`_ 


   -  `Service Instance Health Check Failure`_ 


   -  `Containerization of DPDK vRouter`_ 


   -  `Upgrade Path for Contrail Pods in Kubernetes`_ 


   -  `Contrail and Helm Charts`_ 


   -  `SR-IOV for RHEL and Coexistence with DPDK`_ 


   -  `vrouter to vrouter encryption for complete cluster`_ 


   -  `vRouter to vRouter Hybrid Cloud`_ 


   -  `RBAC for Contrail Analytics`_ 


   -  `Fat flow enhancements`_ 


   -  `CONTRAILEN-246 Get per Compute Virtual Network Route-Table entries via Analytics APIs`_ 


   -  `CONTRAILEN-264 Need a time stamp on each UVE API & UVE Stream response and each event in the UVE & Alarm queues`_ 


   -  `Bare Metal Server Life Cycle Management`_ 


   -  `Support for EVPN Route Type 5`_ 


   -  `Define Tags for a Kubernetes Environment`_ 


   -  `Contrail support for Underlay Management`_ 


   -  `Support for a Flow-Hold Entries Counter in vRouter UVEs`_ 


   -  `Support for Security Policies in Draft Mode`_ 


   -  `Security Insights Dashboard`_ 




EVPN vRouter MultiHoming to Multiple TORs
=========================================

The Contrail control node can be in a situation in which it peers with a set of provider edge (PE) nodes that also contain a multihome CE device or ToR that is multihomed to the PE nodes, and the PEs are in all-active multihoming mode.

Any EVPN route originating through the multihome device is exported to Contrail with two pathsâ€”the multihome device path and the PE path. Those routes need to be load-balanced to prevent skewed traffic flow.

In previous releases, the Contrail controller supports this scenario. In Contrail 5.0, this support has been added to the Contrail vrouter, supporting both Layer 2 and Layer 3 traffic.



Routing Policies Enhanced for Interface Routes
==============================================

Service interface and static routes are proliferating as leaked routes in the routing table of the SDN gateway. To reduce these leaked routes, routing policies have additional term match conditions under the protocol options to distinguish interface routes, service interface routes, and static routes from other VM routes. Also, a new action attribute, ASPATH (autonomous system path), is added that can be appended with a configurable AS list. All of the action attributes of Add/Set/Remove Community, SetLocal-Pref, and Set Med are supported with the new protocol match conditions and the new ASPATH list append action.

Users will be able to configure the new term match and action attributes as needed in the following cases:

   - Setting LocalPref on service interface static routes when exporting to distinguish routes and take further action.


   - Setting different LocalPref for all other reoriginated routes to distinguish routes and take further action.


Additionally, Contrail can set the Local Pref based on community onto imported routes, instead of the data center gateway, allowing direct access to VPN Internet-Shared from Contrail.

See Simple Underlay Connectivity without Gateway. 



Remote Compute
==============

The remote compute feature enables the deployment of Contrail in many small distributed data centers, up to hundreds or even thousands, for telecommunications point-of-presence (PoPs) or central offices (COs). Because each small datacenter has only a small number of computes running only a few applications, it is not cost-effective to deploy a full Contrail cluster of nodes of control, configuration, analytics, database, and the like, on dedicated servers in each distributed PoP. Additionally, manually managing hundreds or thousands of clusters is not feasible operationally.

Remote compute is implements a subcluster that manages compute nodes at remote sites to receive configurations and exchange routes.

See `Remote Compute`_  .



Contrail Networking Packaging without OpenStack
===============================================

You can download an image package for Contrail networking that contains only the Contrail package and its essential elements, without including OpenStack components.

See `Contrail Software Download`_  .



Distributed Source Network Address Translation (SNAT)
=====================================================

The distributed SNAT feature allows virtual machines to reach the IP fabric network using the existing forwarding infrastructure present for compute node connectivity.

Virtual machines currently can have connectivity to the external network by means of floating IP, logical router, or by having underlay forwarding enabled, all of which needs extra routing information pushed to underlay routers or SDN gateways. The logical router is centralized and already implements source NAT, with one service instance to which all traffic is forwarded for NAT. Contrail could use the existing routing infrastructure providing compute node connectivity and extended the same and provide underlay connectivity to virtual machine. This would be achieved by port address translation of virtual machine traffic with IP address of compute node. The following use cases will be supported: Virtual networks having distributed SNAT enabled would be able to communicate with IP fabric network. Session has to be initiated from virtual machine, initiation of session from external network would not be supported Virtual network could be connected to ip-fabric network via logical router, in which traffic from private virtual network would be subjected to distributed SNAT to reach ip-fabric network.

See https://www.juniper.net/documentation/en_US/contrail5.0/topics/task/configuration/snat-vnc.html .



Kubernetes Updates to ip-fabric and Role-Based Access Control
=============================================================

Kubernetes updates to the Contrail ip-fabric enables reachability to public cloud services for Kubernetes pods without using encapsulation and decapsulation, by using ip-fabric-forwarding that makes the ovelray networks part of the underlay ip-fabric networks.



Additionally, now there is mapping of RBAC policies between Kubernetes and Contrail, enabling Contrail RBAC policies in effect to be used in Kubernetes.



Contrail Microservices
======================

Avoiding monolithic containers - break-out each process into its own container.

Ability to support deploying patches without having to update entire Contrail deployment

Breakout of Contrail fat containers to microservices will help customers like AT&T to manage upgrades and patches better. It will help Contrail provisioning and upgrade user experiences.

Breaking out each component into its on Helm chart e.g. Contrail controller with its own helm chart and so on for other contrail components

Nothing is changing in terms contrail functionality with containerization effort.

See .



Ansible Scripts to Provision Contrail
=====================================

Ansible scripts have been updated to streamline the provisioning of Contrail 5.0.

See `new install topic cs`_  .



Load Balancing with HAProxy Available in Contrail Web UI
========================================================

Load balancing using the HAProxy loadbalancer has been used with Contrail in previous releases. In Contrail 5.0, it has been added to the Contrail web UI, so now it is user-configurable by means of the Contrail interface.

See `Using Load Balancers in Contrail.`_  



Contrail plugin for VMware vRealize Orchestrator
=================================================

Starting in Contrail Release 5.0, you must use a dedicated Contrail plugin to connect Contrail to VMware vRealize Orchestrator (vRO). vRO is used to automate the management processes in data centers.

You can use the Contrail plugin to view the Contrail controller configurations in the vRO inventory. You can also use the plugin to modify configurations by using vRO workflows. You can deploy the Contrail plugin in any Java Virtual Machine (JVM) compatible language and load it on an active vRO instance.



Service Instance Health Check Failure
=====================================

In Contrail Release 5.0, when more than one Service Instance (SI) in a service chain fails, reorigination of routes on both sides of the service chain is stopped and routes automatically converge to a backup service chain that is part of another contrail cluster. The vRouter agent drops a connected route when the SI health check fails. A connected route is also dropped if the vRouter agent restarts due to a software failure or when a compute node reboots. You can detect an SI failure by keeping track of corresponding connected routes of the service chain address.

See `Service Instance Health Checks`_  



Containerization of DPDK vRouter
================================

contrail-vrouter-dpdk will run in container.

See



Upgrade Path for Contrail Pods in Kubernetes
============================================



Contrail and Helm Charts
========================

CONTRAILEN-288 Contrail Service IP and Port number should be configurable via Helm Chart

CONTRAILEN-289 Ingress Controllers implementation using Helm via Helm Chart

Support for helm based provisioning of contrail containers for kubernetes

Helm Charts for OpenContrail



SR-IOV for RHEL and Coexistence with DPDK
=========================================

SR-IOV is now available for Red Hat Enterprise Linux and can be implemented in conjunction with DPDK vRouter.



vrouter to vrouter encryption for complete cluster
==================================================

vRouter to vRouter encryption for complete cluster

encryption of data and compute traffic over ipsec / SSL Registered by Sanju Abraham on 2017-12-15 Contrail vrouter sends overlay packets that are either MPLS, GRE or VXLAN which are not encrypted as of current release. There is requirement to encrypt the packet and forward it securely onto the label switched path. IPSec mesh is created based on the LSP path. There are 2 requirements: 1-> Encrypt all packets that are egressing from the contrail vrouter node to another contrail vrouter node based on a global flag. 2-> Policy based encryption for enabling encryption per flow. This blueprint specifically addresses the requirement for encrypting all data traffic egressing the contrail vrouter heading towards another contrail vrouter node.

Contrail vrouter sends overlay packets that are either MPLS, GRE or VXLAN which are not encrypted as of current release. There is requirement to encrypt the packet and forward it securely onto the label switched path. IPSec mesh is created based on the LSP path. There are 2 requirements: 1-> Encrypt all packets that are egressing from the contrail vrouter node to another contrail vrouter node based on a global flag. 2-> Policy based encryption for enabling encryption per flow. This blueprint specifically addresses the requirement for encrypting all data traffic egressing the contrail vrouter heading towards another contrail vrouter node. Set the URL for this specification Blueprint information Status: Started Approver: Rudra Rugge Priority: High Drafter: Sanju Abraham Direction: Needs approval Assignee: prasad miriyala Definition: New Series goal: None Propose as goal Implementation: Started Milestone target: None Started by Sanju Abraham on 2017-12-20 Completed by Related branches Link a related branch Related bugs Link a bug report Sprints Proposed pcb-monthly Propose for sprint Edit Whiteboard Introduction: Contrail vrouter provides L3VPN based overlays for tenant workloads in virtualized, containerized and physical (bare metal) environments. In addition to providing networking, contrail also has native functions to provide load balance, firewall and security policy based enforcement. Contrail supports MPLS and VxLAN overlays. Problem Statement: With MPLS labels being used for overlays, there is a need to securely forward packets over LSP in certain customer environments as part of compliance to the security standards. Tenant data packets egressing from contrail vrouter destined to a workload hosted on another vrouter will have to be encrypted. Proposed Solution: IPSec ESP mode provides authentication, integrity and encryption for the packet, making it the best suited for securely forwarding the tenant data both in private and public contrail clouds. The proposed solution will have ESP packets over MPLS. The structure will be: Ethernet:IP:UDP:ESP The ESP payload will contain: IP:UDP:MPLS:<Inner packet> IPsec tunnels with PSK will be supported. This phase supports only VRouter to VRouter traffic encryption/decryption. Policy based encryption (may be interface based) will be supported in future. This feature should work with existing features. Especially, needs to make sure works with FWP, gateway less forwarding, upcoming distributed NAT. This feature will be supported kernel and DPDK will be addressed later. Crypt modes VRouter, VM or policy based encryption. VRouter modes means, any communication to that VRouter will be encrypted. VM and policy based encryption is to support more granular options for encryption. As the encrypt/decrypt functions are expensive, it will be useful to perform this function granular level. This phase supports only VRouter mode. We will enable 'Crypt' option per Cluster, or VRouter. Cluster option enables Crypt flag in each VRouter in the cluster. Cluster option could UI. Agent conf file will have crypt_interface configured to send traffic for encryption. And each VRouter agent configuration file may also have an option to specify list of IP addresses that it requires to connect via crypt. IPsec IPsec tunnels are created via Strong swan module and encrypt/decrypt provided by xfrm kernel module. Details about IPsec tunnels is in next section.



vRouter to vRouter Hybrid Cloud
===============================

vRouter to vRouter hybrid cloud

contrail multi cloud GW

contrail vrouter provides L3VPN based overlays for tenant workloads in virtualized, containerized and physical (bare metal) environments. In addition to providing networking, contrail also has native functions to provide load balance, firewall and security policy based enforcement. Contrail can be deployed in private datacenter and public VPC, orchestrated by openstack, docker and kubernetes. This blue print addresses the need for providing secure connectivity between private site to site, private site to public and public to public environments. Development environments in more and more customer organizations are now very distributed: - Distributed across multiple data centers (across different geographical locations) or across private and public clouds. In these organizations, development environments stretch across these distributed locations. As a result, the security posture (or Contrail networking services) for distributed applications will have to stretch across the distributed locations. These locations can be Private clouds as well Public cloud tenants. This capability will apply to Contrail Security as well. So we will have to support the notion of Single Pane of Glass functionality across multiple instances of contrail. With SINGLE PANE OF GLASS we refer to: - The capability to orchestrate, manage and monitor contrail, when deployed across multiple sites. - Enable user to perform any service configuration/provisioning operation, as well any analytic i query/operation through the UI of a single site, ensuring that the same operation is executed on i all Contrail clusters participating in the Single pane of Glass - Regarding analytics, the query is performed on data across all sites. - Objects are created in central controller and distributed across the clusters.



RBAC for Contrail Analytics
===========================

Currently Analytics API supports authenticated access for cloud-admin role. However to display network monitoring for tenant pages in the UI, analytics API needs to support RBAC similar to config API so that the tenants can only view information about the networks for which they have the read permissions. 3. Proposed solution Analytics API will map query and UVE objects to configuration objects on which RBAC rules are applied so that read permissions can be verified using VNC API.

See `Role- and Resource-Based Access Control`_  .



Fat flow enhancements
=====================

To enhance fat-flow feature to support ignore of both source and destination ports and/or ignore or either source or destination IP address. This document describes the design and implementation details of Contrail components to achieve this.

Support aggregation of multiple flows into a single flow by ignoring both source and destination ports and/or by ignoring either source or destination IP. Also support fat-flow configuration at VN level.

The current fat flow solution supports aggregation of flows by ignoring either source or destination port for a given protocol. The proposal is to extend this by providing the following options a) Ignore both source and destination ports b) Ignore either source or destination IP c) Combination of both (a) and (b) above. Also fat-flow in the current form is supported only at VMI level. This will be extended to make it configurable at VN level. When it is configured at VN level, it will be applied to all VMIs under that VN.

Schema has fat-flow-protocol object which is of type ProtocolType. This ProtocolType object will be extended further to ignore source or destination IP. Also the port field of ProtocolType can now hold 0 as a valid value. The value 0 indicates that both source and destination ports need to be ignored. Also a new property named virtual-network-fat-flow-protocols for virtual-network object will be defined. This will allow fat-flow to be configured at VN level.

User is expected to create fat-flow-protocol object and associate it at VMI or VN level.

In Configure->Networking->Ports, when we edit any of the ports, a window for that port opens. Here under Fat-Flow(s) section we can create and edit fat-flow configuration. A new field for each fat-flow record named "Ignore Address" will be added. This field can take values of "None", "Source" or "Destination". The existing Port field of each fat-flow record will start taking 0 also as value. Similarly options to configure fat-flow at VN level will be provided under Configure->Networking->Networks



CONTRAILEN-246 Get per Compute Virtual Network Route-Table entries via Analytics APIs
=====================================================================================



CONTRAILEN-264 Need a time stamp on each UVE API & UVE Stream response and each event in the UVE & Alarm queues
================================================================================================================





CONTRAILEN-254 No Timestamp in Contrail Analytics UVE Stream Events
--------------------------------------------------------------------



Bare Metal Server Life Cycle Management
=======================================

Starting with Contrail Release 5.0, you can use Bare Metal Server (BMS) Manager to manage the life cycle of bare metal servers (BMS). BMS Manager can install tenant-specific software images on BMS and attach them to the tenant network in a multi-tenant cloud. BMS Manager provides a single-click solution for the tenants to manage the bare metal servers in their network.



Support for EVPN Route Type 5
=============================

Contrail Release 5.0 supports EVPN Route Type 5 messages as defined in the IETF specification *IP Prefix Advertisement in EVPN* . EVPN Route Type 5 is an extension of EVPN Route Type 2, which carries MAC addresses along with their associated IP addresses. EVPN Route Type 5 facilitates in inter-subnet routing.



Define Tags for a Kubernetes Environment
========================================

Starting in Contrail Release 5.0, you can define tags for a Kubernetes environment. Contrail security policy uses these tags to implement specified Kubernetes policies. You can define tags in the UI or upload configurations in JSON format. The newly defined tags can be used to create and enforce policies in Contrail Security

For more information, see `Contrail Integration with Kubernetes`_  .



Contrail support for Underlay Management
========================================

Contrail Release 5.0 supports underlay network management. The existing Contrail configuration node can provide element management system (EMS) capabilities on physical network elements such as ToR and EoR switches, Spines, SDN gateway, and VPN gateways in the data center. In addition, you can perform basic device management functions such as device discovery, device import, image upgrade, device underlay configuration, and topology discovery from the node. Contrail 5.0 and later supports devices from multiple vendors in the underlay network.

For more information, see *Underlay Management* .



Support for a Flow-Hold Entries Counter in vRouter UVEs
========================================================

Starting with Contrail Release 5.0 , a flow-hold entries counter is transmitted in vRouter User-Visible Entities (UVEs). The counter specifies the number of flows in **hold** state in the vRouter. vRouter uses the flow-hold count to check against a defined limit and when it reaches a defined limit, packets requiring new flows are dropped and new flows are not created till the flow-hold count goes below the defined limit.

Along with the flow-hold entries counter, the vRouter UVEs also provide information associated with a vRouter, such as:

   - Virtual networks present on the vRouter


   - Virtual machines spawned on the server of the vRouter


   - Statistics of the traffic flowing through the vRouter




Support for Security Policies in Draft Mode
===========================================

Starting in Contrail Release 5.0, you can define new security policies and review the policies before enforcing them. You can also edit existing policies and review the changes before updating them. You can define security policies in both global and project scopes.

For more information, see `Security Policies Draft Mode`_  .



Security Insights Dashboard
===========================

Starting with Contrail Release 5.0, Contrail Web UI supports Security Insights Dashboard that provides graphical and tabular insights about various security objects and events.

For more information, see `Security Insights Dashboard`_  .

.. _Simple Underlay Connectivity without Gateway.: 

.. _Remote Compute: https://www.juniper.net/documentation/en_US/contrail5.0/topics/concept/remote-compute-50.html

.. _Contrail Software Download: https://www.juniper.net/support/downloads/?p=contrail#sw

.. _new install topic cs: 

.. _Using Load Balancers in Contrail.: https://www.juniper.net/documentation/en_US/contrail5.0/topics/task/configuration/lbaas-contrail3-F5.html

.. _Service Instance Health Checks: https://www.juniper.net/documentation/en_US/contrail5.0/topics/topic-map/service-instance-health-check.html

.. _Role- and Resource-Based Access Control: https://www.juniper.net/documentation/en_US/contrail5.0/topics/concept/role-resource-access-control-vmc.html

.. _Contrail Integration with Kubernetes: https://www.juniper.net/documentation/en_US/contrail4.0/topics/concept/kubernetes-cni-contrail.html

.. _Security Policies Draft Mode: https://www.juniper.net/documentation/en_US/contrail5.0/topics/concept/security-policy-draft-mode.html

.. _Security Insights Dashboard: https://www.juniper.net/documentation/en_US/contrail5.0/topics/concept/security-policy-draft-mode.html
